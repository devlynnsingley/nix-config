#!/usr/bin/env bash

# u sign

DEST=${1:-hermes}

nix copy --to "ssh-ng://$DEST" ~/.local/state/nix/profiles/profile

cd $HOME

for project in $(grep "^[^#]" ~/.config/projects)
do
    echo $project
    ( cd $project ; \
      if [[ -f .envrc.cache ]]; then \
          source <(direnv apply_dump .envrc.cache) ; \
          if [[ -n "$buildInputs" ]]; then \
              eval nix copy --to ssh-ng://$DEST $buildInputs; \
          fi; \
      fi \
    )
done
