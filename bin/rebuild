#!/usr/bin/env bash

set -ex

case $1 in
    vulcan)
        u vulcan upgrade
        (u vulcan sign ; nix-copy hermes && echo "nix-copy hermes done") &
        (push -f src,kadena,doc,Home hermes && echo "push hermes done") &
        (push athena && echo "push athena done") &
        u vulcan check &
        wait
        notify "Nix on Vulcan upgraded"
        ;;

    hermes)
        u hermes switch travel-ready check
        brew update
        brew upgrade --greedy
        notify "Nix on Hermes switched"
        ;;

    athena)
        u athena switch check
        brew update
        brew upgrade --greedy
        notify "Nix on Athena switched"
        ;;

    *)
        echo "Unrecognized hostname: $1"
        exit 1
        ;;
esac
