#!/usr/bin/env bash

set -ex

case $1 in
    vulcan)
        u vulcan update
        u vulcan sign
        (nix-copy hermes && echo "nix-copy hermes done") &
        (push -f src,kadena,doc,Home hermes && echo "push hermes done") &
        (push athena && echo "push athena done") &
        u vulcan check &
        wait
        notify "Nix on Vulcan updated"
        ;;

    hermes)
        u hermes switch travel-ready check
        notify "Nix on Hermes updated"
        ;;

    athena)
        u athena switch check
        notify "Nix on Athena updated"
        ;;

    *)
        echo "Unrecognized hostname: $1"
        exit 1
        ;;
esac
